---
- name: "Local AI Office Stack ‚Äì Complete Setup"
  hosts: localhost
  gather_facts: true
  
  vars:
    office_domain: "office.local"
    ai_domain: "ai.local"
    postgres_version: "15"
    whisper_model: "medium"
    ollama_model: "mistral"
  
  tasks:
    - name: "Display Stack Overview"
      debug:
        msg: |
          üöÄ Local AI Office Stack ‚Äì Proxmox Edition
          
          üìä Architecture:
          ‚îú‚îÄ‚îÄ vm-gateway (Traefik, HTTPS internal)
          ‚îÇ   ‚îî‚îÄ‚îÄ traefik.local
          ‚îú‚îÄ‚îÄ vm-office (Documentum + DB)
          ‚îÇ   ‚îú‚îÄ‚îÄ paperless.{{ office_domain }}
          ‚îÇ   ‚îî‚îÄ‚îÄ postgres://localhost:5432
          ‚îî‚îÄ‚îÄ vm-ai-lab (AI + Workflows)
              ‚îú‚îÄ‚îÄ whisper ({{ whisper_model }} model)
              ‚îú‚îÄ‚îÄ ollama ({{ ollama_model }} model)
              ‚îú‚îÄ‚îÄ n8n.{{ ai_domain }}
              ‚îî‚îÄ‚îÄ api.{{ ai_domain }}
          
          üîí Security:
          - Traefik: Self-Signed HTTPS (internal only)
          - No WireGuard (local network only)
          - No external API calls
          - All services containerized
          
          ‚ö° Performance:
          - Whisper {{ whisper_model }}: ~2-3s per audio chunk
          - Ollama {{ ollama_model }}: ~100ms response time
          - PostgreSQL: Local persistence
          
          ‚úÖ Production-Ready: YES
          üéØ Use-Case: Office automation + local AI workflows
    
    - name: "Check Prerequisites"
      block:
        - name: "Check CPU cores (min 4)"
          assert:
            that:
              - ansible_processor_vcpus >= 4
            fail_msg: "Need at least 4 CPU cores"
        
        - name: "Check RAM (min 16GB)"
          assert:
            that:
              - ansible_memtotal_mb >= 16000
            fail_msg: "Need at least 16GB RAM"
        
        - name: "Check Docker installed"
          command: docker --version
          register: docker_check
          ignore_errors: true
        
        - name: "Docker status"
          debug:
            msg: "‚úÖ Docker: {{ docker_check.stdout }}"
          when: docker_check.rc == 0
    
    - name: "Print Deployment Checklist"
      debug:
        msg: |
          üìã Next Steps (Deployment Checklist):
          
          1Ô∏è‚É£  Gateway Setup:
              ansible-playbook examples/07-traefik-gateway.yml
          
          2Ô∏è‚É£  Office Services:
              ansible-playbook examples/08-paperless-postgresql.yml
          
          3Ô∏è‚É£  AI Lab Setup:
              ansible-playbook examples/09-whisper-local.yml
              ansible-playbook examples/10-ollama-command-model.yml
              ansible-playbook examples/11-n8n-workflows.yml
          
          4Ô∏è‚É£  Verification:
              ansible-playbook examples/12-verify-all-services.yml
          
          üîó Access (after setup):
          - Dashboard: https://traefik.local
          - Paperless: https://paperless.local
          - n8n: https://n8n.local
          - AI API: https://api.local
