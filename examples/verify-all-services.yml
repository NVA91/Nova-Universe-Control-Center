---
- name: "Verify All Services â€“ Complete Stack"
  hosts: localhost
  gather_facts: false
  
  tasks:
    - name: "Check Traefik"
      uri:
        url: "http://localhost:8080/ping"
        method: GET
      register: traefik_check
      ignore_errors: true
    
    - name: "Check PostgreSQL"
      postgresql_ping:
        db: "postgres"
        login_host: "localhost"
        login_user: "postgres"
        login_password: "{{ vault_postgres_password }}"
      register: postgres_check
      ignore_errors: true
    
    - name: "Check Paperless"
      uri:
        url: "http://localhost:8000/api/"
        method: GET
        user: "admin"
        password: "{{ vault_paperless_admin_password }}"
        force_basic_auth: yes
      register: paperless_check
      ignore_errors: true
    
    - name: "Check Whisper"
      uri:
        url: "http://localhost:8001/health"
        method: GET
      register: whisper_check
      ignore_errors: true
    
    - name: "Check Ollama"
      uri:
        url: "http://localhost:11434/api/tags"
        method: GET
      register: ollama_check
      ignore_errors: true
    
    - name: "Check n8n"
      uri:
        url: "http://localhost:5678/healthz"
        method: GET
      register: n8n_check
      ignore_errors: true
    
    - name: "ğŸ“Š Stack Health Report"
      debug:
        msg: |
          âœ… LOCAL AI OFFICE STACK â€“ VERIFICATION REPORT
          
          Service Status:
          â”œâ”€â”€ Traefik (Gateway):     {{ "âœ… OK" if traefik_check.status == 200 else "âŒ FAILED" }}
          â”œâ”€â”€ PostgreSQL (Database): {{ "âœ… OK" if postgres_check is succeeded else "âŒ FAILED" }}
          â”œâ”€â”€ Paperless (Docs):      {{ "âœ… OK" if paperless_check.status == 200 else "âŒ FAILED" }}
          â”œâ”€â”€ Whisper (Speech):      {{ "âœ… OK" if whisper_check.status in [200, 404] else "âŒ FAILED" }}
          â”œâ”€â”€ Ollama (AI Model):     {{ "âœ… OK" if ollama_check.status == 200 else "âŒ FAILED" }}
          â””â”€â”€ n8n (Workflows):       {{ "âœ… OK" if n8n_check.status == 200 else "âŒ FAILED" }}
          
          ğŸ” Access Points (HTTPS internal):
          - Dashboard:      https://traefik.local
          - Paperless:      https://paperless.local
          - n8n:            https://n8n.local
          - Whisper API:    https://whisper.local
          - Ollama API:     https://ollama.local
          
          ğŸ“‹ Architecture:
          - Network: Docker bridge (traefik)
          - TLS: Self-signed (local only)
          - Persistence: Docker volumes (PostgreSQL, n8n data)
          - No public exposure, no WireGuard needed
          
          ğŸš€ Production Status: READY FOR DEPLOYMENT

